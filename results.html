
<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Свежие видео YouTube</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif;margin:24px;background:#0b0c10;color:#eaf0f1}
    h1{margin:0 0 12px;font-size:24px}
    .meta{opacity:.8;margin-bottom:16px}
    .card{background:#14161c;border:1px solid #232730;border-radius:14px;padding:14px 16px;margin:10px 0;box-shadow:0 1px 4px rgba(0,0,0,.3)}
    .ch{font-weight:600}
    .title{margin:4px 0}
    a{color:#8ab4f8;text-decoration:none}
    a:hover{text-decoration:underline}
    .age{opacity:.8;font-size:13px}
    .controls{margin:8px 0 16px}
    input[type=number]{width:80px;padding:6px;border-radius:8px;border:1px solid #303642;background:#0f1117;color:#eaf0f1}
    button{padding:8px 12px;border-radius:10px;border:1px solid #2e3540;background:#1a1f29;color:#eaf0f1;cursor:pointer}
    button:hover{background:#223042}
    footer{opacity:.7;margin-top:24px;font-size:12px}
  </style>
</head>
<body>
  <h1>Свежие видео YouTube</h1>
  <div class="meta">Данные из <code>latest_results.json</code>, обновляются автоматически.</div>

  <div class="controls">
    <button id="refreshBtn">Обновить</button>
    <span id="status" class="age"></span>
  </div>

  <div id="list"></div>

  <footer>Поддерживается ботом <code>yt_fresh_simple_bot.py</code>. Просто запусти статический сервер в этой папке: <code>python -m http.server 8000</code> и открой <a href="http://localhost:8000/results.html">results.html</a>.</footer>

<script>
const list = document.getElementById('list');
const statusEl = document.getElementById('status');
const btn = document.getElementById('refreshBtn');

function formatAge(sec){
  sec = Math.max(0, sec|0);
  if (sec < 60) return sec + ' сек назад';
  const m = Math.floor(sec / 60);
  if (m < 60) return m + ' мин назад';
  const h = Math.floor(m / 60);
  const mm = m % 60;
  if (h < 24) return h + ' ч' + (mm? ' ' + mm + ' мин' : '') + ' назад';
  const d = Math.floor(h / 24);
  const hh = h % 24;
  if (d < 7) return d + ' д' + (hh? ' ' + hh + ' ч' : '') + ' назад';
  const w = Math.floor(d / 7);
  const dd = d % 7;
  return w + ' нед' + (dd? ' ' + dd + ' д' : '') + ' назад';
}

async function load(){
  try{
    const res = await fetch('latest_results.json?ts=' + Date.now(), {cache:'no-store'});
    if(!res.ok) throw new Error(res.status);
    const data = await res.json();
    const items = data.items || [];
    list.innerHTML = '';
    items.forEach((it, idx) => {
      const div = document.createElement('div');
      div.className = 'card';
      const a = document.createElement('a'); a.href = it.url; a.textContent = it.title; a.target = '_blank'; a.rel='noopener';
      div.innerHTML = '<div class="ch">[' + (it.channel || '') + ']</div>';
      const p = document.createElement('div'); p.className = 'title';
      p.appendChild(a); div.appendChild(p);
      const age = document.createElement('div'); age.className='age';
      age.textContent = formatAge((it.age_seconds||0));
      div.appendChild(age);
      list.appendChild(div);
    });
    const gen = data.generated_at_utc ? new Date(data.generated_at_utc) : new Date();
    statusEl.textContent = 'Ок, обновлено: ' + gen.toLocaleString();
  }catch(e){
    statusEl.textContent = 'Ошибка загрузки: ' + e.message;
  }
}

btn.addEventListener('click', load);
setInterval(load, 10000);
load();
</script>
</body>
</html>
